/*!
  Sqimitive.js - a JavaScript primitive
  http://squizzle.me/js/sqimitive | Public domain/Unlicense
*/
(function(t){var i={nodash:"_"},n="Sqimitive";if("undefined"==typeof exports||exports.nodeType)if("function"==typeof define&&define.amd)define(Object.keys(i),t);else{function s(t,e){for(e=e.split(/\./g);t&&e.length;)t=t[e.shift()];return t}var r="object"==typeof self?self:"object"==typeof global?global:this||{};i=Object.keys(i).map(function(t){var e=s(r,i[t]);if(!e)throw n+": missing dependency: "+t;return e}),1<(n=n.split(/\.([^.]+)$/)).length&&(r=s(r,n.shift())),r[n[0]]=t.apply(this,i)}else i=Object.keys(i).map(function(t){return require(t)}),"undefined"!=typeof module&&module.exports?module.exports=t.apply(this,i):exports=t.apply(this,i)}).call(this,function(f){"use strict";var c=Object.prototype.hasOwnProperty,i=Object.assign||f.extend;var e={version:"1.1",_:f},l=e.Core=function(){this._cid="p"+l.unique("p");var t=this.constructor._copyProps;if(!t)for(var e in t=this.constructor._copyProps=[],this)"object"==typeof this[e]&&null!=this[e]&&-1==this.constructor._shareProps.indexOf(e)&&t.push(e);for(var i=0;i<t.length;i++)this[t[i]]=l.deepClone(this[t[i]])};f.extend(l,{_unique:{},_mergeProps:[],_shareProps:[],_copyProps:null,extend:function(t,e,i){t="string"==typeof arguments[0]&&Array.prototype.shift.call(arguments);var n,s,r,o=(n=this,r=(s=arguments[0])&&c.call(s,"constructor")?s.constructor:function(){return n.apply(this,arguments)},h.prototype=n.prototype,r.prototype=new h,r.__super__=n.prototype,r);function h(){this.constructor=r}return f.extend(o,this,e,{__super__:o.__super__}),o._mergeProps||(o._mergeProps=this._mergeProps),o._shareProps||(o._shareProps=this._shareProps),Object.defineProperty(o,"length",{value:"NotAnArray"}),t&&Object.defineProperty(o,"name",{value:t}),arguments[0]&&o.mixIn(arguments[0]),"string"==typeof o.prototype._childClass&&(o.prototype._childClass=[o,o.prototype._childClass]),o},mixIn:function(t,e){return this.prototype.mixIn(t,e)},stub:function(){},unique:function(t){return this._unique[t]=1+(this._unique[t]||0)},picker:function(e,i){return i=l.toArray(i),function(t){if(t instanceof Object&&e in t)return"function"==typeof t[e]?t[e].apply(t,i):t[e]}},expandFunc:function(e,i){if("string"!=typeof e)return i?f.bind(e,i):e;var t=e.split(/([.-].*)/);return 1<t.length?l.masker(t[0],t[1],i):function(){var t=i||this;return t[e].apply(t,arguments)}},masker:function(n,s,r,o){var h="string"==typeof n,c="number"==typeof s||null==s;return null==s&&(s=1),o=o||[],c||(s=s.replace(/\./g,function(t,e){return 8<e?"-":e+1}).replace(/[^1-9.\-]+/g,"-").replace(/-+$/,"")),function(){for(var t=r||this,e=c?o.concat(f.rest(arguments,s)):o.concat(),i=0;i<s.length;i++)"-"!=s[i]&&e.push(arguments[s[i]-1]);return(h?t[n]:n).apply(t,e)}},deepClone:function(t){if("object"==typeof t&&null!=t)if(Array.isArray(t))t=t.map(l.deepClone);else for(var e in t=i({},t))t[e]=l.deepClone(t[e]);return t},parseEvent:function(t){var e=t.match(/^([+\-=]?)([\w\d.:+\-=]+?)(_*)$/);if(!e)throw new SyntaxError("Bad event name: "+t);return{prefix:e[1],name:e[2],args:e[3]}},fire:function(t,n){var s;return t&&(n=n||[],f.find(t.concat(),function(t){if(null!=t.args&&t.args!=n.length)var e=t.sup?t.sup(t.cx||this,n):void 0;else{if(t.sup||t.res){i=Array.prototype.slice.call(n);t.sup&&i.unshift(t.sup),t.res&&i.unshift(s)}else var i=n;e=t.func.apply(t.cx||this,i)}if(t.ret&&void 0!==e&&(s=e),t.post&&(t.stop=!1,s=t.post(t,s,n),t.stop))return!0},this)),s},toArray:function(t){return"[object Arguments]"==Object.prototype.toString.call(t)?Array.prototype.slice.call(t):Array.isArray(t)?t:[t]}}),f.extend(l.prototype,{_cid:"",_events:{},_eventsByID:{},_eventsByCx:[],_autoOff:[],_logEventID:null,mixIn:function(e,t){var i={mixIns:void 0,finishMixIn:void 0,staticProps:void 0,events:void 0};if(f.each(e.mixIns||[],function(t){this.mixIn.apply(this,[].concat(t))},this),f.each(this.constructor._mergeProps,function(t){t in this&&t in e&&(f.isArray(e[t])?i[t]=this[t].concat(e[t]):i[t]=f.extend({},this[t],e[t]))},this),f.extend(this,e,i),f.extend(this.constructor,e.staticProps||{}),e.events){if(this._events==this.constructor.__super__._events)for(var n in this._events=f.extend({},this._events),this._events)this._events[n]=this._events[n].concat();this.on(e.events)}e.finishMixIn&&e.finishMixIn(this,t)},fire:function(t,e){if(this._events.all&&"all"!=t){var i=arguments.length<2?[]:l.toArray(e).concat();i.unshift(t);var n=this.constructor.fire.call(this,this._events.all,i);if(void 0!==n)return n}return this.constructor.fire.call(this,this._events[t],e)},firer:function(t,e,i){return 1<arguments.length?(e=l.toArray(e),function(){return(i||this).fire(t,e.concat(Array.prototype.slice.call(arguments)))}):function(){return(i||this).fire(t,arguments)}},logEvents:function(t){if("string"!=typeof t)return!t&&arguments.length?(this.off(this._logEventID),this._logEventID=null):console&&console.log&&!this._logEventID&&(this._logEventID=this.on("all",l.logEvents)),this;var e=this._cid;if(this.el){e+="\t\t"+this.el[0].tagName;var i=this.el[0].className.trim();""!=i&&(e+=(" "+i).replace(/\s+/g,"."))}console.log(t+" ("+(arguments.length-1)+") on "+e)},on:function(t,e,i){if(t instanceof Object){for(var n in t)for(var s=n.split(", "),r=0,o=s.length;r<o;++r)this.fuse(s[r],t[n],e);return this}if(2<=arguments.length)return this._regHandler(this.fuse(t,e,i));throw new TypeError("on: Bad arguments")},once:function(t,e,i){if(2<=arguments.length){var n=this.on(t,function(){if(n)return this.off(n),n=null,l.expandFunc(e,this).apply(i||this,arguments)});return n}throw new TypeError("once: Bad arguments")},autoOff:function(t,e,i){if(arguments.length<1){var n=this._autoOff;return this._autoOff=[],f.invoke(n,"off",this),this}for(var s in this._autoOff.push(t),2<arguments.length||(i=this),e)for(var r=s.split(", "),o=0,h=r.length;o<h;++o)t.on(r[o],e[s],i);return t},fuse:function(t,e,i){e=l.expandFunc(e),t=l.parseEvent(t);var n=c.call(this._events,t.name)?this._events[t.name]:this._events[t.name]=[];this._wrapHandler(t.name);var s={func:e,cx:i,event:t.name};if(s.args=t.args.length||null,"+"==t.prefix)s.res=s.ret=!0;else if("="==t.prefix){s.ret=!0,s.supList=n.splice(0,n.length);var r=s.sup=function(t,e){return"[object Arguments]"==Object.prototype.toString.call(e)&&e[0]===r&&(e=Array.prototype.slice.call(e,1)),t.constructor.fire.call(t,s.supList,e)}}return"-"==t.prefix?n.unshift(s):n.push(s),s},_wrapHandler:function(t){if(this[t]!==l.stub)if("function"!=typeof this[t]||this[t]._wrapHandler){if(t in this)return}else this._events[t].unshift({func:this[t],ret:!0});this[t]=this.firer(t),this[t]._wrapHandler=t},_regHandler:function(e){var t=e.id=e.event+"/"+l.unique("e");return(this._eventsByID[t]=e).cx&&(this._cxHandlers(e.cx,function(t){t.push(e)})||this._eventsByCx.push([e.cx,e])),t},_cxHandlers:function(t,e){if(t)for(var i=0,n=this._eventsByCx.length;i<n;++i)if(this._eventsByCx[i][0]===t)return e.call(this,this._eventsByCx[i],i)||!0},off:function(t){if(arguments.length<1)throw new TypeError("off: Bad arguments");return f.isArray(t)?f.each(t,this.off,this):t instanceof Object?this._cxHandlers(t,function(t,e){f.each(this._eventsByCx.splice(e,1)[0].slice(1),this._unregHandler,this)}):-1==t.indexOf("/")?f.each(this._events[t]||[],this._unregHandler,this):this._unregHandler(this._eventsByID[t]),this},_unregHandler:function(i){if(i&&i.id){delete this._eventsByID[i.id],i.func=l.stub,this._cxHandlers(i.cx,function(t,e){t.splice(t.indexOf(i),1),t.length||this._eventsByCx.splice(e,1)});var t=this._events[i.event]||[],e=t.indexOf(i);if(0<=e){var n=[e,1].concat(f.filter(i.supList||[],function(t){return t.func!==l.stub}));t.splice.apply(t,n)}}}}),e.Base=l.extend({_opt:{},_firingSet:null,_parent:null,_parentKey:null,_children:{},_owning:!0,_childClass:null,_childEvents:[],_respToOpt:{},el:!1,elEvents:{},length:0,constructor:function(t){t||Array.prototype.splice.call(arguments,0,1,{}),e.Base.__super__.constructor.apply(this,arguments),this.init.apply(this,arguments),this.postInit.apply(this,arguments)},init:function(t){if(f.isArray(this._childClass)){var e=this._childClass[1].split(/\./g);for(this._childClass=this._childClass[0];e[0];)this._childClass=this._childClass[e.shift()];if(!this._childClass)throw new ReferenceError("init: _childClass by path not found")}for(var i in t)"el"==i||this.set(i,t[i])},postInit:l.stub,render:function(){return this.invoke("attach"),this},attach:function(t){return this},getSet:function(t,e,i,n,s){for(var r=l.toArray(arguments),o=0;o<=2;o++)"function"==typeof r[o]?r.splice(o,0,r[o-1]):null==r[o]&&(r[o]=r[o-1]),r["a"+o]=f.isArray(r[o])?r[o]:[r[o]];var h=f.map(r.a0,this.get,this);return r[3]&&(h=r[3].apply(r[4],h),f.isArray(r[1])||(h=[h])),f.each(h,function(t,e){this.set(r.a1[e],h[e])},this),f.isArray(r[2])?f.map(r[2],this.get,this):this.get(r[2])},get:function(t){return arguments.length?this._opt[t]:f.extend({},this._opt)},set:function(t,e,i){return this.ifSet(t,e,i),this},ifSet:function(t,e,i){i=i||{};var n=this._opt[t],s="normalize_"+t;if(this[s]&&(e=this[s](e,i)),this._opt[t]=e,i.forceFire||!f.isEqual(e,n))return this._fireSet([t,[e,n,i]]),!0},_fireSet:function(t){if(null==this._firingSet){var e=this._firingSet=[t];try{for(;t=e.shift();)this.fire("change_"+t[0],t[1]),this.fire("change",[t[0]].concat(t[1]));this._firingSet=null}catch(t){throw this._firingSet=null,t}}else this._firingSet.push(t)},nest:function(t,e,i){return t instanceof Object&&Array.prototype.splice.call(arguments,0,0,this._defaultKey(t)),i=f.extend({},arguments[2]||{},{key:t,child:e}),this.nestEx(i).child},nestEx:function(t){var e=t.child;if(!(e instanceof this._childClass))throw new TypeError("nestEx: Nesting Sqimitive of wrong class");if("object"==typeof t.key)throw new TypeError("nestEx: Bad key given");var i=t.key+="",n=t.previous=this._children[i];return(t.changed=n!==e)&&(this._owning?(n&&n.unnest(),e.unnest(),(this._children[i]=e)._parent=this,e._parentKey=i,++this.length):(this._children[i]=e,n?this.unnested(n):++this.length),this._forward(".",this._childEvents,e),this._owning&&e.owned()),t},_defaultKey:function(t){return t._cid},owned:l.stub,_forward:function(i,t,n){return f.each(t.concat(),function(t){var e=i+t;n.on(t,function(){return Array.prototype.unshift.call(arguments,n),this.fire(e,arguments)},this)},this),n},unlist:function(t){t instanceof Object&&(t=this.findKey(t));var e=this._children[t+=""];return e&&(this._owning?e.remove():(delete this._children[t],--this.length,this.unnested(e))),e},unnest:function(){var t=this._parent;return t&&(delete t._children[this._parentKey],this._parent=this._parentKey=null,--t.length,t.unnested(this)),this},unnested:function(t){t.off(this),this.length<0&&console&&console.error&&console.error("Broken nesting: sqimitive.length below zero")},nested:function(t){if(!arguments.length)return f.extend({},this._children);if(null!=t){if(!(t instanceof Object))return this._children[t+""];if(null!=this.findKey(t))return t}},slice:function(t,e){return f.values(this._children).slice(t,e)},findKey:function(t,e){var i=t instanceof Object;for(var n in this._children)if(i?this._children[n]==t:t.call(e,this._children[n],n,this._children))return n},_:function(){return f(this.slice())},remove:function(){return this.unnest()},assignChildren:function(t,e){(e=e||{}).assignChildren=!0;var i=e.eqFunc,n=e.keyFunc||this._defaultKey;if(null==i)e.keepMissing||this.each(this.unlist,this);else if("function"!=typeof i){var s=i;i=function(t,e){return e&&t.get(s)==e[s]}}t.data&&(t=t.data),f.isArray(t)||(t=f.values(t));for(var r=i?this.nested():{},o=[],h=0;h<t.length;h++){var c=!1;for(var l in r)if(i.call(this,r[l],t[h])){r[l].assignResp(t[h],e),delete r[l],c=!0;break}if(!c){var u=(new(e.classFunc?e.classFunc.call(this,t[h]):this._childClass)).assignResp(t[h],e),a=this.nestEx(f.extend({},e,{key:n.call(this,u),child:u}));o.push(a)}}return e.keepMissing||f.each(r,this.unlist,this),[o,r]},assignResp:function(t,e){for(var i in(e=e||{}).assignResp=!0,t){var n=t[i],s=this._respToOpt[i];void 0===s&&(s=!e.onlyDefined),!0===s&&(s=i),"function"==typeof s&&(n=(s=s.call(this,n,i,t,e)||[])[1],s=s[0]),0==s||this.set(s,n,e)}return this},bubble:function(t,e,i){return i&&this[t]&&this[t].apply(this,e),this._parent&&this._parent.bubble(t,e,!0),this},sink:function(t,e,i){return i&&this[t]&&this[t].apply(this,e),this.invoke("sink",t,e,!0),this}}),e.Base.prototype._childClass=e.Base,e.Base._mergeProps.push("_opt","elEvents","_respToOpt"),e.Base._shareProps.push("_childClass"),e.Ordered={_ordered:[],events:{"+nestEx":function(t){var e=t.changed;e&&t.previous&&!this._owning&&this._removeFromOrdered(t.key,t.previous),e||(t.oldIndex=this._indexOf(t.key,t.child),(e=!f.isEqual(t.pos,this._ordered[t.oldIndex].pos))&&this._ordered.splice(t.oldIndex,1)),e&&(t.index=this._indexFor(t),this._ordered.splice(t.index,0,f.pick(t,"child","key","pos")),this._repos(t.child,t.index))},unnested:function(e){if(this._owning){var t=f.find(this._ordered,function(t){return t.child==e});this._removeFromOrdered(t.key,e)}},"+unlist":function(e,t){this._owning||(e==t?this._ordered=this._ordered.filter(function(t){return t.child!=e}):this._removeFromOrdered(t,e))},"=slice":function(t,e,i){return f.pluck(this._ordered.slice(e,i),"child")}},_removeFromOrdered:function(t,e){var i=this._indexOf(t,e);if(i<0)throw new TypeError("Broken nesting: sqimitive missing from _ordered");this._ordered.splice(i,1)},_indexOf:function(e,i){return e+="",i=i||this._children[e],f.findIndex(this._ordered,function(t){return t.child==i&&t.key==e})},_indexFor:function(t){return this.constructor.indexFor(this._ordered,t,this._sorter,this)},_sorter:function(t,e,i){return t=null==t.pos?t.key:t.pos,1==arguments.length?t:i<t?1:t<i?-1:0},resort:function(){return this._ordered.sort(function(t,e){return this._sorter(t,e,this._sorter(e))}.bind(this)),this.each(this._repos,this),this},_repos:l.stub,at:function(t){return this._ordered[t]},staticProps:{indexFor:function(t,e,i,n){for(var s=t.length&&i.call(n,e),r=0,o=t.length;r<o;){var h=Math.floor((r+o)/2);-i.call(n,t[h],e,s)<0?o=h:r=h+1}return r}}};return f.each("pick omit keys".split(" "),function(t){e.Base.prototype[t]=function(){return Array.prototype.unshift.call(arguments,this._children),f[t].apply(f,arguments)}}),f.each("each map find filter reject reduce every some contains invoke pluck max min sortBy groupBy indexBy countBy chunk shuffle sample partition toArray without union intersection difference".split(" "),function(t){e.Base.prototype[t]=function(){return Array.prototype.unshift.call(arguments,this.slice()),f[t].apply(f,arguments)}}),f.each("reduceRight first initial last rest indexOf lastIndexOf findIndex findLastIndex".split(" "),function(t){e.Ordered[t]=function(){return Array.prototype.unshift.call(arguments,this.slice()),f[t].apply(f,arguments)}}),e}),function(t){var i={sqimitive:"Sqimitive",jquery:"$"},n="Sqimitive.jQuery";if("undefined"==typeof exports||exports.nodeType)if("function"==typeof define&&define.amd)define(Object.keys(i),t);else{function s(t,e){for(e=e.split(/\./g);t&&e.length;)t=t[e.shift()];return t}var r="object"==typeof self?self:"object"==typeof global?global:this||{};i=Object.keys(i).map(function(t){var e=s(r,i[t]);if(!e)throw n+": missing dependency: "+t;return e}),1<(n=n.split(/\.([^.]+)$/)).length&&(r=s(r,n.shift())),r[n[0]]=t.apply(this,i)}else i=Object.keys(i).map(function(t){return require(t)}),"undefined"!=typeof module&&module.exports?module.exports=t.apply(this,i):exports=t.apply(this,i)}.call(this,function(n,s){"use strict";var r=n._;return n.Base.extend("Sqimitive.jQuery",{el:{tag:"div",className:""},events:{"-init":function(t){if(t&&t.el&&(this.el=t.el),this.el&&!this.constructor.is$(this.el))if(r.isElement(this.el)||"string"==typeof this.el)this.el=s(this.el);else{var e=r.omit(this.el,"tag","className");e.class=this.el.className||"",this.el=s(document.createElement(this.el.tag||"div")).attr(e).data("sqimitive",this)}if(this.el&&!this.el.length)throw new TypeError("init: Empty el")},attach:function(t){if(arguments.length||(t=this.get("attachPath")),((t=t&&(this._parent?this._parent.$(t):s(t)))||{}).length&&t[0]!==this.el[0].parentNode&&(t.append(this.el),this.invoke("attach")),this.el){var i=".sqim-"+this._cid;this.el.off(i),r.each(this.elEvents,function(t,e){t=n.Core.expandFunc(t,this),(e=e.match(/^\s*([^\s.]+)(\.\S*)?(\s+(.*))?$/))[1]+=i,e[4]?this.el.on(e[1],e[4],t):this.el.on(e[1],t)},this)}},"-remove":function(){this.el&&this.el.remove()}},$:function(t){return this.constructor.is$(t)||r.isElement(t)?s(t):this.el?""==t||"."==t?this.el:this.el.find(t):s()}},{$:s,is$:function(t){return t instanceof s||s.zepto&&s.zepto.isZ(t)}})}),function(t){var i={sqimitive:"Sqimitive"},n="Sqimitive.Async";if("undefined"==typeof exports||exports.nodeType)if("function"==typeof define&&define.amd)define(Object.keys(i),t);else{function s(t,e){for(e=e.split(/\./g);t&&e.length;)t=t[e.shift()];return t}var r="object"==typeof self?self:"object"==typeof global?global:this||{};i=Object.keys(i).map(function(t){var e=s(r,i[t]);if(!e)throw n+": missing dependency: "+t;return e}),1<(n=n.split(/\.([^.]+)$/)).length&&(r=s(r,n.shift())),r[n[0]]=t.apply(this,i)}else i=Object.keys(i).map(function(t){return require(t)}),"undefined"!=typeof module&&module.exports?module.exports=t.apply(this,i):exports=t.apply(this,i)}.call(this,function(s){"use strict";var t=s._,r={};return s.Base.extend("Sqimitive.Async",{MAX_PRIORITY:2,_childClass:"",_childEvents:["complete","=exception"],_ordered:{complete:1/0,error:1/0,success:1/0},_opt:{status:null,ignoreError:!1},events:{".complete":"_childComplete",".=exception":function(){this.exception.apply(this,t.rest(arguments,2))},"=nestEx":function(t,e){var i=!this.contains(e.child),n=t(this,arguments);return i&&this._childComplete(n.child),n},change_status:function(){if(!this.isLoading()){var t=this._callPriorities(this.isSuccessful()?"success":"error",[]),e=this._callPriorities("complete",[]);(t||e)&&this.exception(e||t)}},"=toString":function(){return[this.constructor.name,"["+this.length+"]",this.get("ignoreError")?"~":"",null==this.get("status")?"LOADING":this.get("status")?"DONE":"ERROR"].join(" ")}},_callPriorities:function(t,e){for(var i,n=this.MAX_PRIORITY,s=-n;s<=n;s++)try{if(this.fire(t+(s||""),e)===r)break}catch(t){i=i||t}return i},fuse:function(i,t,e){var n=s.Base.prototype.fuse.apply(this,arguments);return this._ordered[i]===1/0&&(n.post=function(t,e){return t.func=s.Core.stub,t.post=void 0,t.stop="complete"===i?this.isLoading():this.isSuccessful()!==("success"===i),e}.bind(this)),n},_childComplete:function(){if(!1!==this.isSuccessful()){var t=this.countBy(function(t){return""+t.isSuccessful()});this.set("status",t.null?null:!t.false)}},_when:function(t,e,i,n,s){if("number"==typeof e)throw new TypeError("Sqimitive.Async: mistaken cx for priority?");if(n)try{t.call(e)}catch(t){this.exception(t)}else i=Math.max(-this.MAX_PRIORITY,Math.min(this.MAX_PRIORITY,i)),this.on(s+(+i||""),t,e);return this},whenComplete:function(t,e,i){return this._when(t,e,i,!this.isLoading(),"complete")},whenError:function(t,e,i){return this._when(t,e,i,0==this.isSuccessful(),"error")},whenSuccess:function(t,e,i){return this._when(t,e,i,1==this.isSuccessful(),"success")},doneIfEmpty:function(){if(!this.length&&this.isLoading())return this.set("status",!0)},clear:function(){return t.each(["success","error","complete"],function(t){this.off(t)},this),this.invoke("abort"),this.invoke("remove"),this.set("status",null),this},isSuccessful:function(){var t=this.get("status");return null==t?null:!(!this.get("ignoreError")&&!t)},isLoading:function(){return null==this.get("status")},success:s.Core.stub,error:s.Core.stub,complete:s.Core.stub,exception:function(t){throw t},abort:s.Core.stub})});